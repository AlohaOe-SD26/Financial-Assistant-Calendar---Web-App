<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Personal Financial Calendar</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{--primary-color:#2563eb;--primary-hover:#1d4ed8;--success-color:#10b981;--danger-color:#ef4444;--warning-color:#f59e0b;--background:#f9fafb;--surface:#ffffff;--border:#e5e7eb;--text-primary:#111827;--text-secondary:#6b7280}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;background-color:var(--background);color:var(--text-primary)}
.auth-screen{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}
.auth-card{background:white;padding:3rem;border-radius:1rem;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);text-align:center;max-width:400px}
.auth-card h1{font-size:2rem;margin-bottom:0.5rem;color:var(--text-primary)}
.auth-card p{color:var(--text-secondary);margin-bottom:2rem}
.sign-in-button{background:var(--primary-color);color:white;border:none;padding:0.75rem 2rem;font-size:1rem;border-radius:0.5rem;cursor:pointer;transition:background 0.2s}
.sign-in-button:hover{background:var(--primary-hover)}
.app-container{display:none}
.app-container.active{display:block}
.app-header{background:white;border-bottom:1px solid var(--border);padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.app-title{display:flex;align-items:center;gap:0.5rem;font-size:1.5rem;font-weight:700}
.user-section{display:flex;align-items:center;gap:1rem}
.sync-status{font-size:0.875rem;color:var(--text-secondary)}
.sign-out-button{background:transparent;border:1px solid var(--border);color:var(--text-primary);padding:0.5rem 1rem;border-radius:0.375rem;cursor:pointer;transition:all 0.2s}
.sign-out-button:hover{background:var(--background)}
.master-navigation{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:0;display:flex;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
.master-navigation button{flex:1;padding:1rem;border:none;background:transparent;color:white;font-size:1rem;font-weight:600;cursor:pointer;transition:background 0.2s}
.master-navigation button.active{background:rgba(255,255,255,0.2);border-bottom:3px solid white}
.master-navigation button:hover:not(.active){background:rgba(255,255,255,0.1)}
.menu-bar{background:white;border-bottom:1px solid var(--border);padding:0.75rem 2rem;display:flex;gap:1rem}
.menu-button{background:transparent;border:1px solid var(--border);padding:0.5rem 1rem;border-radius:0.375rem;cursor:pointer;transition:all 0.2s;font-size:0.875rem}
.menu-button:hover{background:var(--background)}
.app-view{display:none;flex-direction:column;min-height:calc(100vh - 200px)}
.app-view.active{display:flex}
.alert-badge{position:fixed;top:1rem;right:1rem;background:var(--danger-color);color:white;padding:0.5rem 1rem;border-radius:2rem;display:none;align-items:center;gap:0.5rem;cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,0.1);z-index:100}
.alert-badge.active{display:flex}
.alert-count{background:rgba(255,255,255,0.3);padding:0.125rem 0.5rem;border-radius:1rem;font-weight:600}
.forecast-container{background:white;border-bottom:1px solid var(--border);overflow-x:auto;padding:1rem 2rem}
.forecast-days{display:flex;gap:1rem;min-width:min-content}
.forecast-day{flex:0 0 150px;background:var(--background);border:1px solid var(--border);border-radius:0.5rem;padding:1rem;cursor:pointer;transition:all 0.2s}
.forecast-day:hover{box-shadow:0 4px 6px rgba(0,0,0,0.1)}
.forecast-day.today{border-color:var(--success-color);background:#f0fdf4}
.forecast-day.warning{border-color:var(--danger-color);background:#fef2f2}
.forecast-day-header{font-weight:600;margin-bottom:0.5rem;font-size:0.875rem}
.forecast-day-transactions{font-size:0.75rem;color:var(--text-secondary);margin-bottom:0.5rem}
.forecast-day-balance{font-size:1.25rem;font-weight:700;color:var(--success-color)}
.forecast-day-balance.negative{color:var(--danger-color)}
.tab-navigation{background:white;border-bottom:1px solid var(--border);padding:0 2rem;display:flex;gap:0}
.tab-button{background:transparent;border:none;padding:1rem 1.5rem;cursor:pointer;border-bottom:2px solid transparent;color:var(--text-secondary);font-weight:500;transition:all 0.2s}
.tab-button.active{color:var(--primary-color);border-bottom-color:var(--primary-color)}
.tab-button:hover:not(.active){color:var(--text-primary)}
.tab-content{display:none;padding:2rem}
.tab-content.active{display:block}
.data-layout{display:grid;grid-template-columns:300px 1fr;gap:2rem}
.data-sidebar{background:white;border-radius:0.5rem;padding:1.5rem;box-shadow:0 1px 3px rgba(0,0,0,0.1);height:fit-content}
.data-main{background:white;border-radius:0.5rem;padding:1.5rem;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.add-item-button{width:100%;background:var(--primary-color);color:white;border:none;padding:0.75rem;border-radius:0.375rem;cursor:pointer;font-weight:600;margin-bottom:1.5rem;transition:background 0.2s}
.add-item-button:hover{background:var(--primary-hover)}
.profile-selector{margin-bottom:1.5rem}
.profile-selector label{display:block;font-weight:600;margin-bottom:0.5rem;font-size:0.875rem}
.profile-selector select{width:100%;padding:0.5rem;border:1px solid var(--border);border-radius:0.375rem;font-size:0.875rem}
.manage-profiles-button{width:100%;background:transparent;border:1px solid var(--border);padding:0.5rem;border-radius:0.375rem;cursor:pointer;font-size:0.875rem;margin-top:0.5rem}
.manage-profiles-button:hover{background:var(--background)}
.metrics-card{margin-top:1.5rem}
.metric-item{padding:0.75rem 0;border-bottom:1px solid var(--border)}
.metric-item:last-child{border-bottom:none}
.metric-label{font-size:0.875rem;color:var(--text-secondary);margin-bottom:0.25rem}
.metric-value{font-size:1.5rem;font-weight:700}
.metric-value.positive{color:var(--success-color)}
.metric-value.negative{color:var(--danger-color)}
.data-section{margin-bottom:2rem}
.data-section:last-child{margin-bottom:0}
.data-section-header{font-size:1.125rem;font-weight:700;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}
.data-item{background:var(--background);border:1px solid var(--border);border-radius:0.375rem;padding:1rem;margin-bottom:0.5rem;display:flex;justify-content:space-between;align-items:center}
.data-item-info{flex:1}
.data-item-name{font-weight:600;margin-bottom:0.25rem}
.data-item-details{font-size:0.875rem;color:var(--text-secondary)}
.data-item-amount{font-size:1.25rem;font-weight:700;margin-right:1rem}
.data-item-actions{display:flex;gap:0.5rem}
.icon-button{background:transparent;border:1px solid var(--border);width:2rem;height:2rem;border-radius:0.375rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
.icon-button:hover{background:var(--background)}
.icon-button.delete:hover{background:#fef2f2;border-color:var(--danger-color);color:var(--danger-color)}
.calendar-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}
.calendar-month{font-size:1.5rem;font-weight:700}
.calendar-nav{display:flex;gap:0.5rem}
.nav-button{background:white;border:1px solid var(--border);width:2.5rem;height:2.5rem;border-radius:0.375rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
.nav-button:hover{background:var(--background)}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:0.5rem}
.calendar-day-header{text-align:center;font-weight:600;padding:0.5rem;font-size:0.875rem;color:var(--text-secondary)}
.calendar-day{background:white;border:1px solid var(--border);border-radius:0.375rem;padding:0.75rem;min-height:100px;cursor:pointer;transition:all 0.2s}
.calendar-day:hover{box-shadow:0 2px 4px rgba(0,0,0,0.1)}
.calendar-day.other-month{opacity:0.3}
.calendar-day.today{border-color:var(--primary-color);background:#eff6ff}
.calendar-day.warning{background:#fef2f2;border-color:var(--danger-color)}
.calendar-day-number{font-weight:700;margin-bottom:0.5rem}
.calendar-day-transactions{font-size:0.75rem;color:var(--text-secondary);margin-bottom:0.5rem}
.calendar-day-balance{font-size:0.875rem;font-weight:600;color:var(--success-color)}
.calendar-day-balance.negative{color:var(--danger-color)}
.savings-plans-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:1.5rem}
.savings-plan-card{background:white;border:1px solid var(--border);border-radius:0.5rem;padding:1.5rem;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.savings-plan-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:1rem}
.savings-plan-title{display:flex;align-items:center;gap:0.5rem;font-size:1.25rem;font-weight:700}
.savings-plan-category-icon{font-size:1.5rem}
.savings-progress{margin-bottom:1rem}
.progress-bar{width:100%;height:1.5rem;background:var(--background);border-radius:0.75rem;overflow:hidden;margin-bottom:0.5rem}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--success-color),#34d399);transition:width 0.3s;display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-size:0.875rem}
.savings-amounts{display:flex;justify-content:space-between;margin-bottom:1rem;font-size:0.875rem}
.savings-amount{display:flex;flex-direction:column}
.savings-amount-label{color:var(--text-secondary);font-size:0.75rem}
.savings-amount-value{font-weight:700;font-size:1rem}
.savings-projection{background:var(--background);border-radius:0.375rem;padding:0.75rem;margin-bottom:1rem;font-size:0.875rem}
.savings-actions{display:flex;gap:0.5rem}
.savings-button{flex:1;padding:0.5rem;border:1px solid var(--border);border-radius:0.375rem;cursor:pointer;font-size:0.875rem;background:white;transition:all 0.2s}
.savings-button.deposit{background:var(--success-color);color:white;border-color:var(--success-color)}
.savings-button.deposit:hover{background:#059669}
.savings-button.withdraw{background:var(--warning-color);color:white;border-color:var(--warning-color)}
.savings-button.withdraw:hover{background:#d97706}
.savings-button:hover{background:var(--background)}
.report-controls{background:white;border-radius:0.5rem;padding:1.5rem;margin-bottom:1.5rem;box-shadow:0 1px 3px rgba(0,0,0,0.1);display:flex;gap:1rem;align-items:center}
.report-controls label{font-weight:600;margin-right:0.5rem}
.report-controls select{padding:0.5rem;border:1px solid var(--border);border-radius:0.375rem}
.report-chart-container{background:white;border-radius:0.5rem;padding:1.5rem;box-shadow:0 1px 3px rgba(0,0,0,0.1);margin-bottom:1.5rem;height:400px}
.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem}
.metric-card{background:white;border-radius:0.5rem;padding:1.5rem;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
.metric-card-label{font-size:0.875rem;color:var(--text-secondary);margin-bottom:0.5rem}
.metric-card-value{font-size:2rem;font-weight:700}
.modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center}
.modal-overlay.active{display:flex}
.modal{background:white;border-radius:0.5rem;max-width:600px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1)}
.modal-header{padding:1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.modal-title{font-size:1.25rem;font-weight:700}
.modal-close{background:transparent;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-secondary)}
.modal-body{padding:1.5rem}
.modal-footer{padding:1.5rem;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:0.5rem}
.form-group{margin-bottom:1.5rem}
.form-group label{display:block;font-weight:600;margin-bottom:0.5rem;font-size:0.875rem}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:0.5rem;border:1px solid var(--border);border-radius:0.375rem;font-size:0.875rem}
.form-group textarea{resize:vertical;min-height:80px}
.button-primary{background:var(--primary-color);color:white;border:none;padding:0.75rem 1.5rem;border-radius:0.375rem;cursor:pointer;font-weight:600;transition:background 0.2s}
.button-primary:hover{background:var(--primary-hover)}
.button-secondary{background:transparent;border:1px solid var(--border);padding:0.75rem 1.5rem;border-radius:0.375rem;cursor:pointer;transition:all 0.2s}
.button-secondary:hover{background:var(--background)}
.button-danger{background:var(--danger-color);color:white;border:none;padding:0.75rem 1.5rem;border-radius:0.375rem;cursor:pointer;font-weight:600;transition:background 0.2s}
.button-danger:hover{background:#dc2626}
.profile-checkbox-list{max-height:300px;overflow-y:auto;border:1px solid var(--border);border-radius:0.375rem;padding:1rem}
.profile-checkbox-item{display:flex;align-items:center;padding:0.75rem;border-bottom:1px solid var(--border)}
.profile-checkbox-item:last-child{border-bottom:none}
.profile-checkbox-item input{margin-right:0.75rem;width:auto}
.profile-checkbox-item label{font-weight:normal;margin:0;cursor:pointer;flex:1}
.rules-list{max-height:400px;overflow-y:auto}
.rule-item{border:1px solid var(--border);border-radius:0.375rem;padding:1rem;margin-bottom:1rem;background:var(--background)}
.rule-item-header{font-weight:700;margin-bottom:0.75rem;display:flex;justify-content:space-between;align-items:center}
.rule-item-type{font-size:0.75rem;color:var(--text-secondary);background:white;padding:0.25rem 0.5rem;border-radius:0.25rem}
.rule-sources{font-size:0.875rem;color:var(--text-secondary);margin-bottom:0.75rem;padding-left:1rem}
.rule-options{display:flex;gap:1rem;margin-bottom:0.75rem}
.rule-option{flex:1;display:flex;align-items:center;gap:0.5rem}
.rule-option input[type="radio"]{width:auto}
.rule-shared-amount{display:none}
.rule-shared-amount.active{display:block}
.transaction-list{max-height:300px;overflow-y:auto}
.transaction-item{display:flex;justify-content:space-between;align-items:center;padding:0.75rem;border-bottom:1px solid var(--border)}
.transaction-item:last-child{border-bottom:none}
.transaction-item.deposit{background:#f0fdf4}
.transaction-item.withdrawal{background:#fef2f2}
.transaction-info{flex:1}
.transaction-date{font-size:0.875rem;color:var(--text-secondary)}
.transaction-note{font-size:0.875rem;margin-top:0.25rem}
.transaction-amount{font-weight:700;font-size:1.125rem}
.transaction-amount.deposit{color:var(--success-color)}
.transaction-amount.withdrawal{color:var(--danger-color)}
@media (max-width:768px){.data-layout{grid-template-columns:1fr}.data-sidebar{order:2}.data-main{order:1}.calendar-grid{gap:0.25rem}.calendar-day{min-height:80px;padding:0.5rem}.savings-plans-container{grid-template-columns:1fr}.app-header{flex-direction:column;gap:1rem;align-items:flex-start}}
.empty-state{text-align:center;padding:3rem;color:var(--text-secondary)}
.empty-state-icon{font-size:3rem;margin-bottom:1rem}
.empty-state-title{font-size:1.25rem;font-weight:600;margin-bottom:0.5rem;color:var(--text-primary)}
.empty-state-text{margin-bottom:1.5rem}

.alert-list-item{background:var(--background);border:1px solid var(--border);border-radius:0.375rem;padding:1rem;margin-bottom:0.5rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:1rem}
.alert-list-item:hover{background:white;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
.alert-list-item.critical{border-left:4px solid var(--danger-color)}
.alert-list-item.warning{border-left:4px solid var(--warning-color)}
.alert-icon{font-size:1.5rem}
.alert-content{flex:1}
.alert-date{font-weight:600;margin-bottom:0.25rem}
.alert-message{font-size:0.875rem;color:var(--text-secondary);margin-bottom:0.25rem}
.alert-balance{font-weight:700;font-size:1.125rem}
.alert-balance.negative{color:var(--danger-color)}
.alert-balance.warning{color:var(--warning-color)}
</style>
</head>
<body>
<div id="authScreen" class="auth-screen"><div class="auth-card"><h1>üí∞ Financial Calendar</h1><p>Sign in with Google to access your financial data</p><button id="signInButton" class="sign-in-button">Sign In with Google</button></div></div>
<div id="appContainer" class="app-container">
<header class="app-header"><div class="app-title"><span>üí∞</span><span>Personal Financial Calendar</span></div><div class="user-section"><span class="sync-status" id="syncStatus">‚òÅÔ∏è Synced</span><span id="userEmail"></span><button id="signOutButton" class="sign-out-button">Sign Out</button></div></header>
<nav class="master-navigation"><button id="nav-personal" class="active">Personal</button><button id="nav-combined">Combined</button></nav>
<div class="menu-bar"><button class="menu-button" id="manageProfilesBtn">Profiles</button><button class="menu-button" id="exportBtn">Export</button><button class="menu-button" id="importBtn">Import</button><button class="menu-button" id="settingsBtn">Settings</button></div>
<div class="alert-badge" id="alertBadge">‚ö†Ô∏è <span class="alert-count" id="alertCount">0</span></div>
<div id="personal-app-view" class="app-view active">
<div class="forecast-container"><div class="forecast-days" id="personal-forecastDays"></div></div>
<nav class="tab-navigation"><button class="tab-button active" data-tab="personal-data">Data</button><button class="tab-button" data-tab="personal-calendar">Calendar</button><button class="tab-button" data-tab="personal-savings">Savings</button><button class="tab-button" data-tab="personal-reports">Reports</button></nav>
<div id="personal-data" class="tab-content active"><div class="data-layout"><div class="data-sidebar"><button class="add-item-button" id="personal-addItemBtn">‚ûï Add New Item</button><div class="profile-selector"><label>Profile</label><select id="personal-profileSelect"></select><button class="manage-profiles-button" id="personal-manageProfilesBtn">Manage Profiles</button></div><div class="metrics-card"><div class="metric-item"><div class="metric-label">Net Worth</div><div class="metric-value" id="personal-netWorthValue">$0</div></div><div class="metric-item"><div class="metric-label">Total Assets</div><div class="metric-value" id="personal-totalAssets">$0</div></div><div class="metric-item"><div class="metric-label">Total Debts</div><div class="metric-value negative" id="personal-totalDebts">$0</div></div><div class="metric-item"><div class="metric-label">Monthly Income</div><div class="metric-value positive" id="personal-monthlyIncome">$0</div></div><div class="metric-item"><div class="metric-label">Monthly Expenses</div><div class="metric-value negative" id="personal-monthlyExpenses">$0</div></div><div class="metric-item"><div class="metric-label">Cash Flow</div><div class="metric-value" id="personal-monthlyCashFlow">$0</div></div></div></div><div class="data-main"><div id="personal-dataTree"></div></div></div></div>
<div id="personal-calendar" class="tab-content"><div class="calendar-controls"><div class="calendar-month" id="personal-calendarMonth"></div><div class="calendar-nav"><button class="nav-button" id="personal-prevMonth">‚óÄ</button><button class="nav-button" id="personal-todayBtn">Today</button><button class="nav-button" id="personal-nextMonth">‚ñ∂</button></div></div><div class="calendar-grid" id="personal-calendarGrid"></div></div>
<div id="personal-savings" class="tab-content"><button class="add-item-button" id="personal-createSavingsPlanBtn" style="max-width:300px">‚ûï Create Savings Goal</button><div class="savings-plans-container" id="personal-savingsPlansContainer"></div></div>
<div id="personal-reports" class="tab-content"><div class="report-controls"><div><label>Report Type:</label><select id="personal-reportType"><option value="cashflow">Cash Flow Forecast</option><option value="incomeVsExpenses">Income vs Expenses</option><option value="categoryBreakdown">Category Breakdown</option><option value="netWorth">Net Worth Projection</option></select></div><div><label>Period:</label><select id="personal-reportPeriod"><option value="30">1 Month</option><option value="90">3 Months</option><option value="180">6 Months</option><option value="365">12 Months</option></select></div></div><div class="report-chart-container"><canvas id="personal-reportChart"></canvas></div><div class="metrics-grid"><div class="metric-card"><div class="metric-card-label">Savings Rate</div><div class="metric-card-value" id="personal-savingsRate">0%</div></div><div class="metric-card"><div class="metric-card-label">Debt-to-Income</div><div class="metric-card-value" id="personal-debtToIncome">0%</div></div><div class="metric-card"><div class="metric-card-label">Avg Daily Balance (30d)</div><div class="metric-card-value" id="personal-avgBalance">$0</div></div></div></div>
</div>
<div id="combined-app-view" class="app-view">
<div class="forecast-container"><div class="forecast-days" id="combined-forecastDays"></div></div>
<nav class="tab-navigation"><button class="tab-button active" data-tab="combined-data">Data</button><button class="tab-button" data-tab="combined-calendar">Calendar</button><button class="tab-button" data-tab="combined-savings">Savings</button><button class="tab-button" data-tab="combined-reports">Reports</button></nav>
<div id="combined-data" class="tab-content active"><div class="data-layout"><div class="data-sidebar"><button class="add-item-button" id="combined-addItemBtn">‚ûï Add New Item</button><div class="profile-selector"><label>Profile</label><select id="combined-profileSelect"></select><button class="manage-profiles-button" id="combined-manageProfilesBtn">Manage Profiles</button></div><div class="metrics-card"><div class="metric-item"><div class="metric-label">Net Worth</div><div class="metric-value" id="combined-netWorthValue">$0</div></div><div class="metric-item"><div class="metric-label">Total Assets</div><div class="metric-value" id="combined-totalAssets">$0</div></div><div class="metric-item"><div class="metric-label">Total Debts</div><div class="metric-value negative" id="combined-totalDebts">$0</div></div><div class="metric-item"><div class="metric-label">Monthly Income</div><div class="metric-value positive" id="combined-monthlyIncome">$0</div></div><div class="metric-item"><div class="metric-label">Monthly Expenses</div><div class="metric-value negative" id="combined-monthlyExpenses">$0</div></div><div class="metric-item"><div class="metric-label">Cash Flow</div><div class="metric-value" id="combined-monthlyCashFlow">$0</div></div></div></div><div class="data-main"><div id="combined-dataTree"></div></div></div></div>
<div id="combined-calendar" class="tab-content"><div class="calendar-controls"><div class="calendar-month" id="combined-calendarMonth"></div><div class="calendar-nav"><button class="nav-button" id="combined-prevMonth">‚óÄ</button><button class="nav-button" id="combined-todayBtn">Today</button><button class="nav-button" id="combined-nextMonth">‚ñ∂</button></div></div><div class="calendar-grid" id="combined-calendarGrid"></div></div>
<div id="combined-savings" class="tab-content"><button class="add-item-button" id="combined-createSavingsPlanBtn" style="max-width:300px">‚ûï Create Savings Goal</button><div class="savings-plans-container" id="combined-savingsPlansContainer"></div></div>
<div id="combined-reports" class="tab-content"><div class="report-controls"><div><label>Report Type:</label><select id="combined-reportType"><option value="cashflow">Cash Flow Forecast</option><option value="incomeVsExpenses">Income vs Expenses</option><option value="categoryBreakdown">Category Breakdown</option><option value="netWorth">Net Worth Projection</option></select></div><div><label>Period:</label><select id="combined-reportPeriod"><option value="30">1 Month</option><option value="90">3 Months</option><option value="180">6 Months</option><option value="365">12 Months</option></select></div></div><div class="report-chart-container"><canvas id="combined-reportChart"></canvas></div><div class="metrics-grid"><div class="metric-card"><div class="metric-card-label">Savings Rate</div><div class="metric-card-value" id="combined-savingsRate">0%</div></div><div class="metric-card"><div class="metric-card-label">Debt-to-Income</div><div class="metric-card-value" id="combined-debtToIncome">0%</div></div><div class="metric-card"><div class="metric-card-label">Avg Daily Balance (30d)</div><div class="metric-card-value" id="combined-avgBalance">$0</div></div></div></div>
</div>
</div>
<div class="modal-overlay" id="modalOverlay"><div class="modal" id="modalContent"></div></div><div class="modal-overlay" id="alertsModal">
<div class="modal">
<div class="modal-header">
<div class="modal-title">Upcoming Financial Alerts</div>
<button class="modal-close" onclick="app.closeAlertsModal()">√ó</button>
</div>
<div class="modal-body">
<div id="alertListContainer"></div>
</div>
<div class="modal-footer">
<button class="button-secondary" onclick="app.closeAlertsModal()">Close</button>
</div>
</div>
</div>

<script>
const app={CLIENT_ID:'994220951699-f5k7j6fig37c6gb9d9igjb9jjqoio59q.apps.googleusercontent.com',API_KEY:'AIzaSyCeGRt1vaUNWc_ZMBsg26wR-wfSH8C3GKU',SCOPES:'https://www.googleapis.com/auth/drive.file',tokenClient:null,accessToken:null,userEmail:null,driveFileId:null,profiles:{},combinedProfiles:{},personalSavingsPlans:{},combinedSavingsPlans:{},personalPaymentInstances:{},combinedPaymentInstances:{},settings:{safetyBuffer:500,lastUsedPersonalProfile:null,lastUsedCombinedProfile:null},activeView:'personal',personalState:{activeProfileName:null,currentMonth:new Date().getMonth(),currentYear:new Date().getFullYear(),reportChart:null,editingItemId:null,runningBalance:[]},combinedState:{activeProfileName:null,currentMonth:new Date().getMonth(),currentYear:new Date().getFullYear(),reportChart:null,editingItemId:null,runningBalance:[]},tempCombinedProfile:null,tempSelectedProfiles:[],tempMergeRules:{},currentAlerts:[],
init:function(){var self=this;this.setupGoogleAuth();this.setupEventListeners()},
setupGoogleAuth:function(){var self=this;var ck=setInterval(function(){if(window.google&&window.google.accounts){clearInterval(ck);self.tokenClient=google.accounts.oauth2.initTokenClient({client_id:self.CLIENT_ID,scope:self.SCOPES,callback:function(r){if(r.error){alert('Authentication failed');return}self.accessToken=r.access_token;self.handleAuthSuccess()}})}},100)},
signIn:function(){if(this.tokenClient){this.tokenClient.requestAccessToken({prompt:'consent'})}else{alert('Please refresh page')}},
handleAuthSuccess:function(){this.getUserEmail()},
getUserEmail:function(){var self=this;fetch('https://www.googleapis.com/oauth2/v2/userinfo',{headers:{'Authorization':'Bearer '+self.accessToken}}).then(function(r){return r.json()}).then(function(d){self.userEmail=d.email;document.getElementById('userEmail').textContent=d.email;self.loadFromDrive()}).catch(function(e){alert('Failed to get user info')})},
signOut:function(){this.accessToken=null;this.userEmail=null;this.driveFileId=null;document.getElementById('authScreen').style.display='flex';document.getElementById('appContainer').classList.remove('active');this.profiles={};this.combinedProfiles={};this.personalSavingsPlans={};this.combinedSavingsPlans={};this.personalPaymentInstances={};this.combinedPaymentInstances={}},
loadFromDrive:function(){var self=this;fetch("https://www.googleapis.com/drive/v3/files?q=name='financial_calendar_data.json'&spaces=drive",{headers:{'Authorization':'Bearer '+self.accessToken}}).then(function(r){return r.json()}).then(function(d){if(d.files&&d.files.length>0){self.driveFileId=d.files[0].id;self.loadFileContent(d.files[0].id)}else{self.createNewFile()}}).catch(function(e){alert('Failed to load data')})},
loadFileContent:function(fid){var self=this;fetch('https://www.googleapis.com/drive/v3/files/'+fid+'?alt=media',{headers:{'Authorization':'Bearer '+self.accessToken}}).then(function(r){return r.json()}).then(function(d){self.profiles=d.profiles||{};self.combinedProfiles=d.combinedProfiles||{};self.personalSavingsPlans=d.personalSavingsPlans||{};self.combinedSavingsPlans=d.combinedSavingsPlans||{};self.personalPaymentInstances=d.personalPaymentInstances||{};self.combinedPaymentInstances=d.combinedPaymentInstances||{};self.settings=Object.assign({safetyBuffer:500,lastUsedPersonalProfile:null,lastUsedCombinedProfile:null},d.settings||{});self.showApp()}).catch(function(e){self.createNewFile()})},
createNewFile:function(){var self=this;var iData={profiles:{},combinedProfiles:{},personalSavingsPlans:{},combinedSavingsPlans:{},personalPaymentInstances:{},combinedPaymentInstances:{},settings:{safetyBuffer:500,lastUsedPersonalProfile:null,lastUsedCombinedProfile:null}};var meta={name:'financial_calendar_data.json',mimeType:'application/json'};var fd=new FormData();fd.append('metadata',new Blob([JSON.stringify(meta)],{type:'application/json'}));fd.append('file',new Blob([JSON.stringify(iData)],{type:'application/json'}));fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',{method:'POST',headers:{'Authorization':'Bearer '+self.accessToken},body:fd}).then(function(r){return r.json()}).then(function(d){self.driveFileId=d.id;self.profiles=iData.profiles;self.combinedProfiles=iData.combinedProfiles;self.personalSavingsPlans=iData.personalSavingsPlans;self.combinedSavingsPlans=iData.combinedSavingsPlans;self.personalPaymentInstances=iData.personalPaymentInstances;self.combinedPaymentInstances=iData.combinedPaymentInstances;self.settings=iData.settings;self.showApp()}).catch(function(e){alert('Failed to create data file')})},
saveToDrive:function(){var self=this;if(!self.driveFileId)return;document.getElementById('syncStatus').textContent='‚òÅÔ∏è Saving...';var data={profiles:self.profiles,combinedProfiles:self.combinedProfiles,personalSavingsPlans:self.personalSavingsPlans,combinedSavingsPlans:self.combinedSavingsPlans,personalPaymentInstances:self.personalPaymentInstances,combinedPaymentInstances:self.combinedPaymentInstances,settings:self.settings};fetch('https://www.googleapis.com/upload/drive/v3/files/'+self.driveFileId+'?uploadType=media',{method:'PATCH',headers:{'Authorization':'Bearer '+self.accessToken,'Content-Type':'application/json'},body:JSON.stringify(data)}).then(function(r){return r.json()}).then(function(res){document.getElementById('syncStatus').textContent='‚òÅÔ∏è Synced';setTimeout(function(){document.getElementById('syncStatus').textContent='‚òÅÔ∏è Synced'},2000)}).catch(function(e){document.getElementById('syncStatus').textContent='‚ùå Failed'})},
showApp:function(){document.getElementById('authScreen').style.display='none';document.getElementById('appContainer').classList.add('active');if(Object.keys(this.profiles).length===0){this.profiles['My Budget']={name:'My Budget',assets:[],incomes:[],expenses:[]};this.personalState.activeProfileName='My Budget';this.settings.lastUsedPersonalProfile='My Budget';this.saveToDrive()}else{if(this.settings.lastUsedPersonalProfile&&this.profiles[this.settings.lastUsedPersonalProfile]){this.personalState.activeProfileName=this.settings.lastUsedPersonalProfile}else{this.personalState.activeProfileName=Object.keys(this.profiles)[0]}}if(this.settings.lastUsedCombinedProfile&&this.combinedProfiles[this.settings.lastUsedCombinedProfile]){this.combinedState.activeProfileName=this.settings.lastUsedCombinedProfile}else if(Object.keys(this.combinedProfiles).length>0){this.combinedState.activeProfileName=Object.keys(this.combinedProfiles)[0]}this.renderAll()},
getActiveState:function(){return this.activeView==='personal'?this.personalState:this.combinedState},
getActiveDataStore:function(){return this.activeView==='personal'?this.profiles:this.combinedProfiles},
getActiveSavingsPlans:function(){return this.activeView==='personal'?this.personalSavingsPlans:this.combinedSavingsPlans},
getActivePaymentInstances:function(){return this.activeView==='personal'?this.personalPaymentInstances:this.combinedPaymentInstances},
getActiveProfileData:function(){var st=this.getActiveState();var store=this.getActiveDataStore();return store[st.activeProfileName]},
getActiveUIContext:function(){var px=this.activeView==='personal'?'personal':'combined';return{forecastDays:px+'-forecastDays',calendarGrid:px+'-calendarGrid',calendarMonth:px+'-calendarMonth',prevMonth:px+'-prevMonth',nextMonth:px+'-nextMonth',todayBtn:px+'-todayBtn',netWorthValue:px+'-netWorthValue',totalAssets:px+'-totalAssets',totalDebts:px+'-totalDebts',monthlyIncome:px+'-monthlyIncome',monthlyExpenses:px+'-monthlyExpenses',monthlyCashFlow:px+'-monthlyCashFlow',dataTree:px+'-dataTree',profileSelect:px+'-profileSelect',savingsPlansContainer:px+'-savingsPlansContainer',reportChart:px+'-reportChart',reportType:px+'-reportType',reportPeriod:px+'-reportPeriod',savingsRate:px+'-savingsRate',debtToIncome:px+'-debtToIncome',avgBalance:px+'-avgBalance'}},
switchView:function(nv){document.getElementById(this.activeView+'-app-view').classList.remove('active');this.activeView=nv;document.getElementById(this.activeView+'-app-view').classList.add('active');document.querySelectorAll('.master-navigation button').forEach(function(b){b.classList.remove('active')});document.getElementById('nav-'+nv).classList.add('active');var tabs=document.querySelectorAll('#'+nv+'-app-view .tab-button');tabs.forEach(function(t,i){if(i===0)t.classList.add('active');else t.classList.remove('active')});var conts=document.querySelectorAll('#'+nv+'-app-view .tab-content');conts.forEach(function(c,i){if(i===0)c.classList.add('active');else c.classList.remove('active')});this.renderAll()},
renderAll:function(){this.updateProfileSelector();this.updateMetrics();this.updateDataTree();this.update7DayForecast();this.updateCalendar();this.renderSavingsPlans();this.updateAlerts()},
updateProfileSelector:function(){var ids=this.getActiveUIContext();var st=this.getActiveState();var store=this.getActiveDataStore();var sel=document.getElementById(ids.profileSelect);sel.innerHTML='';var names=Object.keys(store);if(names.length===0){var opt=document.createElement('option');opt.value='';opt.textContent='No profiles';sel.appendChild(opt);return}names.forEach(function(n){var opt=document.createElement('option');opt.value=n;opt.textContent=n;if(n===st.activeProfileName)opt.selected=true;sel.appendChild(opt)})},
updateMetrics:function(){var ids=this.getActiveUIContext();var prof=this.getActiveProfileData();if(!prof){document.getElementById(ids.netWorthValue).textContent='$0';document.getElementById(ids.totalAssets).textContent='$0';document.getElementById(ids.totalDebts).textContent='$0';document.getElementById(ids.monthlyIncome).textContent='$0';document.getElementById(ids.monthlyExpenses).textContent='$0';document.getElementById(ids.monthlyCashFlow).textContent='$0';return}var tAssets=0;var tDebts=0;if(prof.assets){prof.assets.forEach(function(a){if(a.category==='Debt'){tDebts+=Math.abs(a.value)}else{tAssets+=a.value}})}var netW=tAssets-tDebts;var mInc=0;if(prof.incomes){prof.incomes.forEach(function(inc){mInc+=app.normalizeToMonthly(inc.amount,inc.frequency)})}var mExp=0;if(prof.expenses){prof.expenses.forEach(function(exp){mExp+=app.normalizeToMonthly(exp.amount,exp.frequency)})}var cf=mInc-mExp;document.getElementById(ids.netWorthValue).textContent=this.formatCurrency(netW);document.getElementById(ids.totalAssets).textContent=this.formatCurrency(tAssets);document.getElementById(ids.totalDebts).textContent=this.formatCurrency(tDebts);document.getElementById(ids.monthlyIncome).textContent=this.formatCurrency(mInc);document.getElementById(ids.monthlyExpenses).textContent=this.formatCurrency(mExp);var cfEl=document.getElementById(ids.monthlyCashFlow);cfEl.textContent=this.formatCurrency(cf);cfEl.className='metric-value '+(cf>=0?'positive':'negative')},
updateDataTree:function(){var ids=this.getActiveUIContext();var prof=this.getActiveProfileData();var cont=document.getElementById(ids.dataTree);if(!prof){cont.innerHTML='<div class="empty-state"><div class="empty-state-icon">üìä</div><div class="empty-state-title">No Profile Selected</div><div class="empty-state-text">Create or select a profile to get started</div></div>';return}var h='';h+='<div class="data-section">';h+='<div class="data-section-header">Assets <span>('+(prof.assets?prof.assets.length:0)+')</span></div>';if(prof.assets&&prof.assets.length>0){prof.assets.forEach(function(a){h+='<div class="data-item">';h+='<div class="data-item-info">';h+='<div class="data-item-name">'+app.escapeHtml(a.name)+'</div>';h+='<div class="data-item-details">'+a.category+'</div>';h+='</div>';h+='<div class="data-item-amount">'+app.formatCurrency(a.value)+'</div>';h+='<div class="data-item-actions">';h+='<button class="icon-button" onclick="app.editItem(\'asset\',\''+a.id+'\')">‚úèÔ∏è</button>';h+='<button class="icon-button delete" onclick="app.deleteItem(\'asset\',\''+a.id+'\')">üóëÔ∏è</button>';h+='</div>';h+='</div>'})}else{h+='<div style="color:var(--text-secondary);font-size:0.875rem;padding:1rem">No assets</div>'}h+='</div>';h+='<div class="data-section">';h+='<div class="data-section-header">Income Sources <span>('+(prof.incomes?prof.incomes.length:0)+')</span></div>';if(prof.incomes&&prof.incomes.length>0){prof.incomes.forEach(function(inc){var mAmt=app.normalizeToMonthly(inc.amount,inc.frequency);h+='<div class="data-item">';h+='<div class="data-item-info">';h+='<div class="data-item-name">'+app.escapeHtml(inc.name)+'</div>';h+='<div class="data-item-details">'+app.formatCurrency(inc.amount)+' '+inc.frequency+' (‚âà'+app.formatCurrency(mAmt)+'/mo)</div>';h+='</div>';h+='<div class="data-item-amount">'+app.formatCurrency(mAmt)+'</div>';h+='<div class="data-item-actions">';h+='<button class="icon-button" onclick="app.editItem(\'income\',\''+inc.id+'\')">‚úèÔ∏è</button>';h+='<button class="icon-button delete" onclick="app.deleteItem(\'income\',\''+inc.id+'\')">üóëÔ∏è</button>';h+='</div>';h+='</div>'})}else{h+='<div style="color:var(--text-secondary);font-size:0.875rem;padding:1rem">No income sources</div>'}h+='</div>';h+='<div class="data-section">';h+='<div class="data-section-header">Expenses <span>('+(prof.expenses?prof.expenses.length:0)+')</span></div>';if(prof.expenses&&prof.expenses.length>0){prof.expenses.forEach(function(exp){var mAmt=app.normalizeToMonthly(exp.amount,exp.frequency);h+='<div class="data-item">';h+='<div class="data-item-info">';h+='<div class="data-item-name">'+app.escapeHtml(exp.name)+'</div>';h+='<div class="data-item-details">'+exp.category+' ‚Ä¢ '+app.formatCurrency(exp.amount)+' '+exp.frequency+' (‚âà'+app.formatCurrency(mAmt)+'/mo)</div>';h+='</div>';h+='<div class="data-item-amount">'+app.formatCurrency(mAmt)+'</div>';h+='<div class="data-item-actions">';h+='<button class="icon-button" onclick="app.editItem(\'expense\',\''+exp.id+'\')">‚úèÔ∏è</button>';h+='<button class="icon-button delete" onclick="app.deleteItem(\'expense\',\''+exp.id+'\')">üóëÔ∏è</button>';h+='</div>';h+='</div>'})}else{h+='<div style="color:var(--text-secondary);font-size:0.875rem;padding:1rem">No expenses</div>'}h+='</div>';cont.innerHTML=h},
calculateRunningBalance:function(startDate,days){var prof=this.getActiveProfileData();if(!prof)return[];var results=[];var curBal=0;if(prof.assets){prof.assets.forEach(function(a){if(a.category==='Cash'||a.category==='Checking Account'){curBal+=a.value}})}for(var i=0;i<days;i++){var chkDate=new Date(startDate);chkDate.setDate(chkDate.getDate()+i);var dayTransactions=[];if(prof.incomes){prof.incomes.forEach(function(inc){if(app.isScheduledForDate(inc,chkDate)){curBal+=inc.amount;dayTransactions.push({type:'income',name:inc.name,amount:inc.amount,frequency:inc.frequency,category:inc.category||''})}})}if(prof.expenses){prof.expenses.forEach(function(exp){if(app.isScheduledForDate(exp,chkDate)){curBal-=exp.amount;dayTransactions.push({type:'expense',name:exp.name,amount:exp.amount,frequency:exp.frequency,category:exp.category||''})}})}results.push({date:new Date(chkDate),balance:curBal,transactions:dayTransactions})}return results},
isScheduledForDate:function(item,checkDate){var sDate=new Date(item.startDate);var chk=new Date(checkDate);if(chk<sDate)return false;if(item.endDate){var eDate=new Date(item.endDate);if(chk>eDate)return false}var daysSince=Math.floor((chk-sDate)/(1000*60*60*24));switch(item.frequency){case 'daily':return true;case 'weekly':return daysSince%7===0;case 'biweekly':return daysSince%14===0;case 'monthly':return chk.getDate()===sDate.getDate();case 'quarterly':if(chk.getDate()!==sDate.getDate())return false;var mDiff=(chk.getFullYear()-sDate.getFullYear())*12+(chk.getMonth()-sDate.getMonth());return mDiff%3===0;case 'annually':return chk.getDate()===sDate.getDate()&&chk.getMonth()===sDate.getMonth();default:return false}},
normalizeToMonthly:function(amt,freq){switch(freq){case 'daily':return amt*30.4375;case 'weekly':return amt*4.3333;case 'biweekly':return amt*2.1666;case 'monthly':return amt;case 'quarterly':return amt*0.3333;case 'annually':return amt*0.0833;default:return amt}},
update7DayForecast:function(){var ids=this.getActiveUIContext();var cont=document.getElementById(ids.forecastDays);var today=new Date();today.setHours(0,0,0,0);var fcst=this.calculateRunningBalance(today,7);var h='';fcst.forEach(function(day,idx){var isTdy=idx===0;var isWarn=day.balance<app.settings.safetyBuffer;var cls='forecast-day';if(isTdy)cls+=' today';if(isWarn)cls+=' warning';var dStr=day.date.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});h+='<div class="'+cls+'">';h+='<div class="forecast-day-header">'+dStr+'</div>';h+='<div class="forecast-day-transactions">'+day.transactions.length+' trans</div>';h+='<div class="forecast-day-balance '+(day.balance<0?'negative':'')+'">'+app.formatCurrency(day.balance)+'</div>';h+='</div>'});cont.innerHTML=h},
updateCalendar:function(){var ids=this.getActiveUIContext();var st=this.getActiveState();var mNames=['January','February','March','April','May','June','July','August','September','October','November','December'];document.getElementById(ids.calendarMonth).textContent=mNames[st.currentMonth]+' '+st.currentYear;var fDay=new Date(st.currentYear,st.currentMonth,1);var lDay=new Date(st.currentYear,st.currentMonth+1,0);var prvLDay=new Date(st.currentYear,st.currentMonth,0);var fDayOfWk=fDay.getDay();var daysInMo=lDay.getDate();var daysInPrvMo=prvLDay.getDate();var grid=document.getElementById(ids.calendarGrid);var h='';var dayHdrs=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];dayHdrs.forEach(function(d){h+='<div class="calendar-day-header">'+d+'</div>'});var mStart=new Date(st.currentYear,st.currentMonth,1);var daysToShow=42;var sDate=new Date(mStart);sDate.setDate(sDate.getDate()-fDayOfWk);var balData=this.calculateRunningBalance(sDate,daysToShow);var today=new Date();today.setHours(0,0,0,0);for(var i=fDayOfWk-1;i>=0;i--){var day=daysInPrvMo-i;var dIdx=fDayOfWk-1-i;var dData=balData[dIdx]||{balance:0,transactions:[]};h+='<div class="calendar-day other-month">';h+='<div class="calendar-day-number">'+day+'</div>';if(dData.transactions.length>0){h+='<div class="calendar-day-transactions">'+dData.transactions.length+' trans</div>'}h+='<div class="calendar-day-balance '+(dData.balance<0?'negative':'')+'">'+app.formatCurrency(dData.balance)+'</div>';h+='</div>'}for(var day=1;day<=daysInMo;day++){var dayDate=new Date(st.currentYear,st.currentMonth,day);dayDate.setHours(0,0,0,0);var dIdx=fDayOfWk+day-1;var dData=balData[dIdx]||{balance:0,transactions:[]};var isTdy=dayDate.getTime()===today.getTime();var isWarn=dData.balance<app.settings.safetyBuffer;var cls='calendar-day';if(isTdy)cls+=' today';if(isWarn)cls+=' warning';h+='<div class="'+cls+'">';h+='<div class="calendar-day-number">'+day+'</div>';if(dData.transactions.length>0){h+='<div class="calendar-day-transactions">'+dData.transactions.length+' trans</div>'}h+='<div class="calendar-day-balance '+(dData.balance<0?'negative':'')+'">'+app.formatCurrency(dData.balance)+'</div>';h+='</div>'}var remDays=42-(fDayOfWk+daysInMo);for(var day=1;day<=remDays;day++){var dIdx=fDayOfWk+daysInMo+day-1;var dData=balData[dIdx]||{balance:0,transactions:[]};h+='<div class="calendar-day other-month">';h+='<div class="calendar-day-number">'+day+'</div>';if(dData.transactions.length>0){h+='<div class="calendar-day-transactions">'+dData.transactions.length+' trans</div>'}h+='<div class="calendar-day-balance '+(dData.balance<0?'negative':'')+'">'+app.formatCurrency(dData.balance)+'</div>';h+='</div>'}grid.innerHTML=h;
var calDays=grid.querySelectorAll('.calendar-day:not(.other-month)');
calDays.forEach(function(dayEl){
var dayNum=dayEl.querySelector('.calendar-day-number');
if(dayNum){
var day=parseInt(dayNum.textContent);
if(day){
dayEl.onclick=function(){
var clickDate=new Date(st.currentYear,st.currentMonth,day);
app.showDayDetail(clickDate.toISOString().split('T')[0]);
};
}
}
});},
prevMonth:function(){var st=this.getActiveState();st.currentMonth--;if(st.currentMonth<0){st.currentMonth=11;st.currentYear--}this.updateCalendar()},
nextMonth:function(){var st=this.getActiveState();st.currentMonth++;if(st.currentMonth>11){st.currentMonth=0;st.currentYear++}this.updateCalendar()},
goToToday:function(){var st=this.getActiveState();var tdy=new Date();st.currentMonth=tdy.getMonth();st.currentYear=tdy.getFullYear();this.updateCalendar()},
renderSavingsPlans:function(){var ids=this.getActiveUIContext();var cont=document.getElementById(ids.savingsPlansContainer);var plans=this.getActiveSavingsPlans();if(Object.keys(plans).length===0){cont.innerHTML='<div class="empty-state"><div class="empty-state-icon">üí∞</div><div class="empty-state-title">No Savings Goals</div><div class="empty-state-text">Create your first savings goal</div></div>';return}var catIcons={emergency:'üö®',vacation:'‚úàÔ∏è',purchase:'üõçÔ∏è',education:'üéì',retirement:'üèñÔ∏è',other:'üí∞'};var h='';Object.keys(plans).forEach(function(pid){var pl=plans[pid];var prog=pl.targetAmount>0?(pl.currentAmount/pl.targetAmount)*100:0;var rem=pl.targetAmount-pl.currentAmount;var projHtml='';if(pl.transactions&&pl.transactions.length>0){var deps=pl.transactions.filter(function(t){return t.type==='deposit'});if(deps.length>0){var tDeps=deps.reduce(function(s,t){return s+t.amount},0);var avgC=tDeps/deps.length;if(rem>0&&avgC>0){var dNeeded=Math.ceil(rem/avgC);projHtml='<div class="savings-projection">';if(pl.targetDate){var dUntil=Math.floor((new Date(pl.targetDate)-new Date())/(1000*60*60*24));var dailySav=rem/Math.max(dUntil,1);if(dUntil>0){projHtml+='üìÖ '+dUntil+' days until target<br>';projHtml+='üíµ Save '+app.formatCurrency(dailySav)+'/day'}else{projHtml+='‚è∞ Target date passed'}}else{projHtml+='üìä ~'+dNeeded+' more deposits'}projHtml+='</div>'}}}h+='<div class="savings-plan-card">';h+='<div class="savings-plan-header">';h+='<div class="savings-plan-title">';h+='<span class="savings-plan-category-icon">'+catIcons[pl.category]+'</span>';h+='<span>'+app.escapeHtml(pl.name)+'</span>';h+='</div>';h+='</div>';h+='<div class="savings-progress">';h+='<div class="progress-bar">';h+='<div class="progress-fill" style="width:'+Math.min(prog,100)+'%">'+Math.round(prog)+'%</div>';h+='</div>';h+='</div>';h+='<div class="savings-amounts">';h+='<div class="savings-amount">';h+='<div class="savings-amount-label">Current</div>';h+='<div class="savings-amount-value">'+app.formatCurrency(pl.currentAmount)+'</div>';h+='</div>';h+='<div class="savings-amount">';h+='<div class="savings-amount-label">Target</div>';h+='<div class="savings-amount-value">'+app.formatCurrency(pl.targetAmount)+'</div>';h+='</div>';h+='<div class="savings-amount">';h+='<div class="savings-amount-label">Remaining</div>';h+='<div class="savings-amount-value">'+app.formatCurrency(rem)+'</div>';h+='</div>';h+='</div>';if(projHtml){h+=projHtml}h+='<div class="savings-actions">';h+='<button class="savings-button deposit" onclick="app.showSavingsTransaction(\''+pid+'\',\'deposit\')">+ Deposit</button>';h+='<button class="savings-button withdraw" onclick="app.showSavingsTransaction(\''+pid+'\',\'withdrawal\')">- Withdraw</button>';h+='<button class="savings-button" onclick="app.showSavingsDetails(\''+pid+'\')">Details</button>';h+='</div>';h+='</div>'});cont.innerHTML=h},
updateAlerts:function(){var tdy=new Date();tdy.setHours(0,0,0,0);var fcst=this.calculateRunningBalance(tdy,30);var alerts=[];fcst.forEach(function(day){var alrt={date:day.date.toISOString().split('T')[0],dateObj:new Date(day.date),balance:day.balance,transactions:day.transactions};if(day.balance<0){alrt.type='critical';alrt.icon='‚ùå';alrt.message='Negative balance - immediate action needed';alerts.push(alrt)}else if(day.balance<app.settings.safetyBuffer){alrt.type='warning';alrt.icon='‚ö†Ô∏è';alrt.message='Balance below safety buffer ($'+app.settings.safetyBuffer+')';alerts.push(alrt)}});this.currentAlerts=alerts;var badge=document.getElementById('alertBadge');var cntEl=document.getElementById('alertCount');if(alerts.length>0){badge.classList.add('active');cntEl.textContent=alerts.length}else{badge.classList.remove('active')}},
showAddItemModal:function(){var h='<div class="modal-header">';h+='<div class="modal-title">Add New Item</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';h+='<div class="form-group">';h+='<label>Item Type</label>';h+='<select id="itemType" onchange="app.updateAddItemForm()">';h+='<option value="asset">Asset</option>';h+='<option value="income">Income</option>';h+='<option value="expense">Expense</option>';h+='</select>';h+='</div>';h+='<div id="itemFormFields"></div>';h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-secondary" onclick="app.closeModal()">Cancel</button>';h+='<button class="button-primary" onclick="app.saveItem()">Save</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active');this.updateAddItemForm()},
updateAddItemForm:function(){var typ=document.getElementById('itemType').value;var cont=document.getElementById('itemFormFields');var h='<div class="form-group">';h+='<label>Name *</label>';h+='<input type="text" id="itemName" placeholder="Enter name" required>';h+='</div>';if(typ==='asset'){h+='<div class="form-group">';h+='<label>Category *</label>';h+='<select id="itemCategory">';h+='<option value="Cash">Cash</option>';h+='<option value="Checking Account">Checking Account</option>';h+='<option value="Savings Account">Savings Account</option>';h+='<option value="Investment Account">Investment Account</option>';h+='<option value="Property">Property</option>';h+='<option value="Vehicle">Vehicle</option>';h+='<option value="Debt">Debt</option>';h+='<option value="Other">Other</option>';h+='</select>';h+='</div>';h+='<div class="form-group">';h+='<label>Value/Balance *</label>';h+='<input type="number" id="itemAmount" placeholder="0.00" step="0.01" required>';h+='</div>'}else{h+='<div class="form-group">';h+='<label>Amount *</label>';h+='<input type="number" id="itemAmount" placeholder="0.00" step="0.01" required>';h+='</div>';h+='<div class="form-group">';h+='<label>Frequency *</label>';h+='<select id="itemFrequency">';h+='<option value="daily">Daily</option>';h+='<option value="weekly">Weekly</option>';h+='<option value="biweekly">Biweekly</option>';h+='<option value="monthly" selected>Monthly</option>';h+='<option value="quarterly">Quarterly</option>';h+='<option value="annually">Annually</option>';h+='</select>';h+='</div>';h+='<div class="form-group">';h+='<label>Start Date *</label>';h+='<input type="date" id="itemStartDate" required>';h+='</div>';h+='<div class="form-group">';h+='<label>End Date (Optional)</label>';h+='<input type="date" id="itemEndDate">';h+='</div>';if(typ==='expense'){h+='<div class="form-group">';h+='<label>Category *</label>';h+='<select id="itemCategory">';h+='<option value="Housing">Housing</option>';h+='<option value="Food & Dining">Food & Dining</option>';h+='<option value="Transportation">Transportation</option>';h+='<option value="Utilities">Utilities</option>';h+='<option value="Healthcare">Healthcare</option>';h+='<option value="Entertainment">Entertainment</option>';h+='<option value="Shopping">Shopping</option>';h+='<option value="Debt Payment">Debt Payment</option>';h+='<option value="Insurance">Insurance</option>';h+='<option value="Education">Education</option>';h+='<option value="Savings/Investment">Savings/Investment</option>';h+='<option value="Other">Other</option>';h+='</select>';h+='</div>'}}cont.innerHTML=h;if(typ!=='asset'){var tdy=new Date().toISOString().split('T')[0];document.getElementById('itemStartDate').value=tdy}},
saveItem:function(){var typ=document.getElementById('itemType').value;var name=document.getElementById('itemName').value.trim();var amt=parseFloat(document.getElementById('itemAmount').value);if(!name){alert('Enter a name');return}if(isNaN(amt)||amt<0){alert('Enter valid amount');return}var prof=this.getActiveProfileData();if(!prof){alert('No profile');return}var id=typ+'_'+Date.now();if(typ==='asset'){var cat=document.getElementById('itemCategory').value;if(!prof.assets){prof.assets=[]}prof.assets.push({id:id,name:name,category:cat,value:amt})}else{var freq=document.getElementById('itemFrequency').value;var sDate=document.getElementById('itemStartDate').value;var eDate=document.getElementById('itemEndDate').value;if(!sDate){alert('Enter start date');return}var itm={id:id,name:name,amount:amt,frequency:freq,startDate:sDate,endDate:eDate||null};if(typ==='income'){if(!prof.incomes){prof.incomes=[]}prof.incomes.push(itm)}else{var cat=document.getElementById('itemCategory').value;itm.category=cat;if(!prof.expenses){prof.expenses=[]}prof.expenses.push(itm)}}this.saveToDrive();this.closeModal();this.renderAll()},
editItem:function(typ,id){var prof=this.getActiveProfileData();if(!prof)return;var itm=null;if(typ==='asset'){itm=prof.assets.find(function(a){return a.id===id})}else if(typ==='income'){itm=prof.incomes.find(function(i){return i.id===id})}else if(typ==='expense'){itm=prof.expenses.find(function(e){return e.id===id})}if(!itm)return;var h='<div class="modal-header">';h+='<div class="modal-title">Edit '+typ.charAt(0).toUpperCase()+typ.slice(1)+'</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';h+='<div class="form-group">';h+='<label>Name *</label>';h+='<input type="text" id="editItemName" value="'+this.escapeHtml(itm.name)+'" required>';h+='</div>';if(typ==='asset'){h+='<div class="form-group">';h+='<label>Category *</label>';h+='<select id="editItemCategory">';var aCats=['Cash','Checking Account','Savings Account','Investment Account','Property','Vehicle','Debt','Other'];aCats.forEach(function(c){h+='<option value="'+c+'"'+(itm.category===c?' selected':'')+'>'+c+'</option>'});h+='</select>';h+='</div>';h+='<div class="form-group">';h+='<label>Value/Balance *</label>';h+='<input type="number" id="editItemAmount" value="'+itm.value+'" step="0.01" required>';h+='</div>'}else{h+='<div class="form-group">';h+='<label>Amount *</label>';h+='<input type="number" id="editItemAmount" value="'+itm.amount+'" step="0.01" required>';h+='</div>';h+='<div class="form-group">';h+='<label>Frequency *</label>';h+='<select id="editItemFrequency">';var freqs=['daily','weekly','biweekly','monthly','quarterly','annually'];freqs.forEach(function(f){h+='<option value="'+f+'"'+(itm.frequency===f?' selected':'')+'>'+f.charAt(0).toUpperCase()+f.slice(1)+'</option>'});h+='</select>';h+='</div>';h+='<div class="form-group">';h+='<label>Start Date *</label>';h+='<input type="date" id="editItemStartDate" value="'+itm.startDate+'" required>';h+='</div>';h+='<div class="form-group">';h+='<label>End Date (Optional)</label>';h+='<input type="date" id="editItemEndDate" value="'+(itm.endDate||'')+'">';h+='</div>';if(typ==='expense'){h+='<div class="form-group">';h+='<label>Category *</label>';h+='<select id="editItemCategory">';var eCats=['Housing','Food & Dining','Transportation','Utilities','Healthcare','Entertainment','Shopping','Debt Payment','Insurance','Education','Savings/Investment','Other'];eCats.forEach(function(c){h+='<option value="'+c+'"'+(itm.category===c?' selected':'')+'>'+c+'</option>'});h+='</select>';h+='</div>'}}h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-secondary" onclick="app.closeModal()">Cancel</button>';h+='<button class="button-primary" onclick="app.updateItem(\''+typ+'\',\''+id+'\')">Update</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
updateItem:function(typ,id){var prof=this.getActiveProfileData();if(!prof)return;var name=document.getElementById('editItemName').value.trim();var amt=parseFloat(document.getElementById('editItemAmount').value);if(!name){alert('Enter name');return}if(isNaN(amt)||amt<0){alert('Enter valid amount');return}var itm=null;if(typ==='asset'){itm=prof.assets.find(function(a){return a.id===id});if(itm){itm.name=name;itm.category=document.getElementById('editItemCategory').value;itm.value=amt}}else if(typ==='income'){itm=prof.incomes.find(function(i){return i.id===id});if(itm){itm.name=name;itm.amount=amt;itm.frequency=document.getElementById('editItemFrequency').value;itm.startDate=document.getElementById('editItemStartDate').value;itm.endDate=document.getElementById('editItemEndDate').value||null}}else if(typ==='expense'){itm=prof.expenses.find(function(e){return e.id===id});if(itm){itm.name=name;itm.amount=amt;itm.frequency=document.getElementById('editItemFrequency').value;itm.startDate=document.getElementById('editItemStartDate').value;itm.endDate=document.getElementById('editItemEndDate').value||null;itm.category=document.getElementById('editItemCategory').value}}this.saveToDrive();this.closeModal();this.renderAll()},
deleteItem:function(typ,id){if(!confirm('Delete this item?'))return;var prof=this.getActiveProfileData();if(!prof)return;if(typ==='asset'){prof.assets=prof.assets.filter(function(a){return a.id!==id})}else if(typ==='income'){prof.incomes=prof.incomes.filter(function(i){return i.id!==id})}else if(typ==='expense'){prof.expenses=prof.expenses.filter(function(e){return e.id!==id})}this.saveToDrive();this.renderAll()},
showProfileManager:function(){var store=this.getActiveDataStore();var vName=this.activeView==='personal'?'Personal':'Combined';var h='<div class="modal-header">';h+='<div class="modal-title">Manage '+vName+' Profiles</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';if(Object.keys(store).length===0){h+='<div class="empty-state">';h+='<div class="empty-state-icon">üìÅ</div>';h+='<div class="empty-state-title">No Profiles</div>';h+='<div class="empty-state-text">Create first profile</div>';h+='</div>'}else{Object.keys(store).forEach(function(n){h+='<div class="data-item">';h+='<div class="data-item-info">';h+='<div class="data-item-name">'+app.escapeHtml(n)+'</div>';h+='</div>';h+='<div class="data-item-actions">';h+='<button class="icon-button" onclick="app.renameProfile(\''+app.escapeHtml(n)+'\')">‚úèÔ∏è</button>';h+='<button class="icon-button delete" onclick="app.deleteProfile(\''+app.escapeHtml(n)+'\')">üóëÔ∏è</button>';h+='</div>';h+='</div>'})}h+='</div>';h+='<div class="modal-footer">';if(this.activeView==='combined'){h+='<button class="button-secondary" onclick="app.showCombinedProfileCreator()">Create from Personal</button>'}h+='<button class="button-primary" onclick="app.showCreateProfile()">+ Create New</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
showCreateProfile:function(){var vName=this.activeView==='personal'?'Personal':'Combined';var h='<div class="modal-header">';h+='<div class="modal-title">Create New '+vName+' Profile</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';h+='<div class="form-group">';h+='<label>Profile Name *</label>';h+='<input type="text" id="newProfileName" placeholder="e.g., My Budget">';h+='</div>';h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-secondary" onclick="app.showProfileManager()">Back</button>';h+='<button class="button-primary" onclick="app.createProfile()">Create</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
createProfile:function(){var name=document.getElementById('newProfileName').value.trim();if(!name){alert('Enter profile name');return}var store=this.getActiveDataStore();if(store[name]){alert('Profile exists');return}store[name]={name:name,assets:[],incomes:[],expenses:[]};var st=this.getActiveState();st.activeProfileName=name;if(this.activeView==='personal'){this.settings.lastUsedPersonalProfile=name}else{this.settings.lastUsedCombinedProfile=name}this.saveToDrive();this.closeModal();this.renderAll()},
renameProfile:function(oldN){var newN=prompt('Enter new name:',oldN);if(!newN||newN===oldN)return;var store=this.getActiveDataStore();if(store[newN]){alert('Name exists');return}store[newN]=store[oldN];store[newN].name=newN;delete store[oldN];var st=this.getActiveState();if(st.activeProfileName===oldN){st.activeProfileName=newN}if(this.activeView==='personal'){if(this.settings.lastUsedPersonalProfile===oldN){this.settings.lastUsedPersonalProfile=newN}}else{if(this.settings.lastUsedCombinedProfile===oldN){this.settings.lastUsedCombinedProfile=newN}}this.saveToDrive();this.showProfileManager();this.renderAll()},
deleteProfile:function(name){if(!confirm('Delete "'+name+'"?'))return;var store=this.getActiveDataStore();delete store[name];var st=this.getActiveState();if(st.activeProfileName===name){var rem=Object.keys(store);st.activeProfileName=rem.length>0?rem[0]:null}this.saveToDrive();this.showProfileManager();this.renderAll()},
showCombinedProfileCreator:function(){this.closeModal();this.showCombinedProfileNameModal()},
showCombinedProfileNameModal:function(){var h='<div class="modal-header">';h+='<div class="modal-title">Create Combined Profile</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';h+='<div class="form-group">';h+='<label>Profile Name *</label>';h+='<input type="text" id="combinedProfileName" placeholder="e.g., Family Budget">';h+='<small style="color:var(--text-secondary);display:block;margin-top:0.5rem">Name for new combined profile</small>';h+='</div>';h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-secondary" onclick="app.showProfileManager()">Cancel</button>';h+='<button class="button-primary" onclick="app.goToProfileSelection()">Next ‚Üí</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
goToProfileSelection:function(){var name=document.getElementById('combinedProfileName').value.trim();if(!name){alert('Enter name');return}if(this.combinedProfiles[name]){alert('Name exists');return}this.tempCombinedProfile={name:name};this.showProfileSelectionModal()},
showProfileSelectionModal:function(){var h='<div class="modal-header">';h+='<div class="modal-title">Select Personal Profiles to Merge</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';if(Object.keys(this.profiles).length===0){h+='<div class="empty-state">';h+='<div class="empty-state-icon">üìÅ</div>';h+='<div class="empty-state-title">No Personal Profiles</div>';h+='<div class="empty-state-text">Create personal profiles first</div>';h+='</div>'}else{h+='<div class="profile-checkbox-list">';Object.keys(this.profiles).forEach(function(n){h+='<div class="profile-checkbox-item">';h+='<input type="checkbox" id="profile_'+app.escapeHtml(n)+'" value="'+app.escapeHtml(n)+'">';h+='<label for="profile_'+app.escapeHtml(n)+'">'+app.escapeHtml(n)+'</label>';h+='</div>'});h+='</div>'}h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-secondary" onclick="app.showCombinedProfileNameModal()">‚Üê Back</button>';h+='<button class="button-primary" onclick="app.goToRulesEditor()">Next: Configure ‚Üí</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
goToRulesEditor:function(){this.tempSelectedProfiles=[];Object.keys(this.profiles).forEach(function(n){var cb=document.getElementById('profile_'+app.escapeHtml(n));if(cb&&cb.checked){app.tempSelectedProfiles.push(n)}});if(this.tempSelectedProfiles.length===0){alert('Select at least one');return}this.showRulesEditorModal()},
showRulesEditorModal:function(){var grpItems={incomes:{},expenses:{}};this.tempSelectedProfiles.forEach(function(pName){var prof=app.profiles[pName];if(prof.incomes){prof.incomes.forEach(function(inc){if(!grpItems.incomes[inc.name]){grpItems.incomes[inc.name]=[]}grpItems.incomes[inc.name].push({profile:pName,item:inc})})}if(prof.expenses){prof.expenses.forEach(function(exp){if(!grpItems.expenses[exp.name]){grpItems.expenses[exp.name]=[]}grpItems.expenses[exp.name].push({profile:pName,item:exp})})}});this.tempMergeRules={};Object.keys(grpItems.incomes).forEach(function(n){var items=grpItems.incomes[n];var tAmt=items.reduce(function(s,i){return s+i.item.amount},0);app.tempMergeRules[n]={type:'income',mode:items.length>1?'personal':'shared',items:items,mergedAmount:tAmt}});Object.keys(grpItems.expenses).forEach(function(n){var items=grpItems.expenses[n];var tAmt=items.reduce(function(s,i){return s+i.item.amount},0);app.tempMergeRules[n]={type:'expense',mode:items.length>1?'shared':'personal',items:items,mergedAmount:tAmt}});var h='<div class="modal-header">';h+='<div class="modal-title">Configure Merge Rules</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';h+='<div class="rules-list">';Object.keys(this.tempMergeRules).forEach(function(iName){var rule=app.tempMergeRules[iName];var rId='rule_'+iName.replace(/[^a-zA-Z0-9]/g,'_');h+='<div class="rule-item">';h+='<div class="rule-item-header">';h+='<span>'+app.escapeHtml(iName)+'</span>';h+='<span class="rule-item-type">'+rule.type.toUpperCase()+'</span>';h+='</div>';h+='<div class="rule-sources">';rule.items.forEach(function(itm){h+='‚Ä¢ '+itm.profile+': '+app.formatCurrency(itm.item.amount)+' '+itm.item.frequency+'<br>'});h+='</div>';h+='<div class="rule-options">';h+='<div class="rule-option">';h+='<input type="radio" id="'+rId+'_personal" name="'+rId+'" value="personal"'+(rule.mode==='personal'?' checked':'')+' onchange="app.updateRuleMode(\''+iName+'\',\'personal\')">';h+='<label for="'+rId+'_personal">Personal (Keep Separate)</label>';h+='</div>';h+='<div class="rule-option">';h+='<input type="radio" id="'+rId+'_shared" name="'+rId+'" value="shared"'+(rule.mode==='shared'?' checked':'')+' onchange="app.updateRuleMode(\''+iName+'\',\'shared\')">';h+='<label for="'+rId+'_shared">Shared (Merge)</label>';h+='</div>';h+='</div>';h+='<div class="rule-shared-amount'+(rule.mode==='shared'?' active':'')+'" id="'+rId+'_amount">';h+='<div class="form-group" style="margin-bottom:0">';h+='<label>Combined Amount</label>';h+='<input type="number" id="'+rId+'_value" value="'+rule.mergedAmount+'" step="0.01" onchange="app.updateRuleMergedAmount(\''+iName+'\',this.value)">';h+='<small style="color:var(--text-secondary);display:block;margin-top:0.25rem">Original total: '+app.formatCurrency(rule.items.reduce(function(s,i){return s+i.item.amount},0))+'</small>';h+='</div>';h+='</div>';h+='</div>'});if(Object.keys(this.tempMergeRules).length===0){h+='<div class="empty-state">';h+='<div class="empty-state-text">No items found</div>';h+='</div>'}h+='</div>';h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-secondary" onclick="app.showProfileSelectionModal()">‚Üê Back</button>';h+='<button class="button-primary" onclick="app.createCombinedProfile()">Create Combined Profile</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
updateRuleMode:function(iName,mode){if(this.tempMergeRules[iName]){this.tempMergeRules[iName].mode=mode;var rId='rule_'+iName.replace(/[^a-zA-Z0-9]/g,'_');var amtDiv=document.getElementById(rId+'_amount');if(mode==='shared'){amtDiv.classList.add('active')}else{amtDiv.classList.remove('active')}}},
updateRuleMergedAmount:function(iName,val){if(this.tempMergeRules[iName]){this.tempMergeRules[iName].mergedAmount=parseFloat(val)}},
createCombinedProfile:function(){var newProf={name:this.tempCombinedProfile.name,assets:[],incomes:[],expenses:[]};this.tempSelectedProfiles.forEach(function(pName){var prof=app.profiles[pName];if(prof.assets){prof.assets.forEach(function(a){newProf.assets.push({id:'asset_'+Date.now()+'_'+Math.random(),name:a.name+' ('+pName+')',category:a.category,value:a.value})})}});Object.keys(this.tempMergeRules).forEach(function(iName){var rule=app.tempMergeRules[iName];if(rule.mode==='personal'){rule.items.forEach(function(src){var newItm=Object.assign({},src.item);newItm.id=rule.type+'_'+Date.now()+'_'+Math.random();newItm.name=iName+' ('+src.profile+')';if(rule.type==='income'){newProf.incomes.push(newItm)}else{newProf.expenses.push(newItm)}})}else{var fItm=rule.items[0].item;var mrgItm={id:rule.type+'_'+Date.now()+'_'+Math.random(),name:iName,amount:rule.mergedAmount,frequency:fItm.frequency,startDate:fItm.startDate,endDate:fItm.endDate||null};if(rule.type==='expense'){mrgItm.category=fItm.category;newProf.expenses.push(mrgItm)}else{newProf.incomes.push(mrgItm)}}});this.combinedProfiles[newProf.name]=newProf;this.combinedState.activeProfileName=newProf.name;this.settings.lastUsedCombinedProfile=newProf.name;this.tempCombinedProfile=null;this.tempSelectedProfiles=[];this.tempMergeRules={};this.saveToDrive();this.closeModal();if(this.activeView!=='combined'){this.switchView('combined')}else{this.renderAll()}},
showCreateSavingsPlan:function(){var h='<div class="modal-header">';h+='<div class="modal-title">Create Savings Goal</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';h+='<div class="form-group">';h+='<label>Goal Name *</label>';h+='<input type="text" id="savingsPlanName" placeholder="e.g., Emergency Fund">';h+='</div>';h+='<div class="form-group">';h+='<label>Target Amount *</label>';h+='<input type="number" id="savingsPlanTarget" placeholder="0.00" step="0.01">';h+='</div>';h+='<div class="form-group">';h+='<label>Target Date (Optional)</label>';h+='<input type="date" id="savingsPlanDate">';h+='</div>';h+='<div class="form-group">';h+='<label>Category *</label>';h+='<select id="savingsPlanCategory">';h+='<option value="emergency">üö® Emergency</option>';h+='<option value="vacation">‚úàÔ∏è Vacation</option>';h+='<option value="purchase">üõçÔ∏è Purchase</option>';h+='<option value="education">üéì Education</option>';h+='<option value="retirement">üèñÔ∏è Retirement</option>';h+='<option value="other">üí∞ Other</option>';h+='</select>';h+='</div>';h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-secondary" onclick="app.closeModal()">Cancel</button>';h+='<button class="button-primary" onclick="app.createSavingsPlan()">Create Goal</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
createSavingsPlan:function(){var name=document.getElementById('savingsPlanName').value.trim();var tgt=parseFloat(document.getElementById('savingsPlanTarget').value);var date=document.getElementById('savingsPlanDate').value;var cat=document.getElementById('savingsPlanCategory').value;if(!name){alert('Enter goal name');return}if(isNaN(tgt)||tgt<=0){alert('Enter valid target');return}var plans=this.getActiveSavingsPlans();var id='savings_'+Date.now();plans[id]={id:id,name:name,targetAmount:tgt,currentAmount:0,targetDate:date||null,category:cat,createdDate:new Date().toISOString(),transactions:[]};this.saveToDrive();this.closeModal();this.renderSavingsPlans()},
showSavingsTransaction:function(pId,typ){var plans=this.getActiveSavingsPlans();var pl=plans[pId];if(!pl)return;var h='<div class="modal-header">';h+='<div class="modal-title">'+(typ==='deposit'?'Add Deposit':'Add Withdrawal')+'</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';h+='<div style="background:var(--background);padding:1rem;border-radius:0.375rem;margin-bottom:1rem">';h+='<strong>'+this.escapeHtml(pl.name)+'</strong><br>';h+='<small style="color:var(--text-secondary)">Current: '+this.formatCurrency(pl.currentAmount)+' / Target: '+this.formatCurrency(pl.targetAmount)+'</small>';h+='</div>';h+='<div class="form-group">';h+='<label>Amount *</label>';h+='<input type="number" id="transactionAmount" placeholder="0.00" step="0.01">';h+='</div>';h+='<div class="form-group">';h+='<label>Date *</label>';h+='<input type="date" id="transactionDate" value="'+new Date().toISOString().split('T')[0]+'">';h+='</div>';h+='<div class="form-group">';h+='<label>Note (Optional)</label>';h+='<textarea id="transactionNote" placeholder="Add note..."></textarea>';h+='</div>';h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-secondary" onclick="app.closeModal()">Cancel</button>';h+='<button class="button-primary" onclick="app.addSavingsTransaction(\''+pId+'\',\''+typ+'\')">Add '+(typ==='deposit'?'Deposit':'Withdrawal')+'</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
addSavingsTransaction:function(pId,typ){var amt=parseFloat(document.getElementById('transactionAmount').value);var date=document.getElementById('transactionDate').value;var note=document.getElementById('transactionNote').value.trim();if(isNaN(amt)||amt<=0){alert('Enter valid amount');return}if(!date){alert('Enter date');return}var plans=this.getActiveSavingsPlans();var pl=plans[pId];if(!pl)return;var trans={id:'transaction_'+Date.now(),type:typ,amount:amt,date:date,note:note,timestamp:new Date().toISOString()};pl.transactions.push(trans);if(typ==='deposit'){pl.currentAmount+=amt}else{pl.currentAmount-=amt}this.saveToDrive();this.closeModal();this.renderSavingsPlans()},
showSavingsDetails:function(pId){var plans=this.getActiveSavingsPlans();var pl=plans[pId];if(!pl)return;var prog=pl.targetAmount>0?(pl.currentAmount/pl.targetAmount)*100:0;var rem=pl.targetAmount-pl.currentAmount;var h='<div class="modal-header">';h+='<div class="modal-title">Savings Goal Details</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';h+='<div style="background:var(--background);padding:1.5rem;border-radius:0.5rem;margin-bottom:1.5rem">';h+='<h3 style="margin-bottom:1rem">'+this.escapeHtml(pl.name)+'</h3>';h+='<div class="progress-bar" style="margin-bottom:1rem">';h+='<div class="progress-fill" style="width:'+Math.min(prog,100)+'%">'+Math.round(prog)+'%</div>';h+='</div>';h+='<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;font-size:0.875rem">';h+='<div><div style="color:var(--text-secondary)">Current</div><strong>'+this.formatCurrency(pl.currentAmount)+'</strong></div>';h+='<div><div style="color:var(--text-secondary)">Target</div><strong>'+this.formatCurrency(pl.targetAmount)+'</strong></div>';h+='<div><div style="color:var(--text-secondary)">Remaining</div><strong>'+this.formatCurrency(rem)+'</strong></div>';h+='</div>';if(pl.targetDate){h+='<div style="margin-top:1rem;color:var(--text-secondary);font-size:0.875rem">';h+='üéØ Target: '+new Date(pl.targetDate).toLocaleDateString();h+='</div>'}h+='</div>';h+='<div style="margin-bottom:1rem">';h+='<h4 style="margin-bottom:0.5rem">Transaction History</h4>';h+='<div style="margin-bottom:1rem">';h+='<button class="savings-button deposit" style="margin-right:0.5rem" onclick="app.showSavingsTransaction(\''+pId+'\',\'deposit\')">+ Deposit</button>';h+='<button class="savings-button withdraw" onclick="app.showSavingsTransaction(\''+pId+'\',\'withdrawal\')">- Withdraw</button>';h+='</div>';h+='</div>';if(pl.transactions&&pl.transactions.length>0){var sortTrans=pl.transactions.slice().sort(function(a,b){return new Date(b.date)-new Date(a.date)});h+='<div class="transaction-list">';sortTrans.forEach(function(trans){h+='<div class="transaction-item '+trans.type+'">';h+='<div class="transaction-info">';h+='<div class="transaction-date">'+new Date(trans.date).toLocaleDateString()+'</div>';if(trans.note){h+='<div class="transaction-note">'+app.escapeHtml(trans.note)+'</div>'}h+='</div>';h+='<div class="transaction-amount '+trans.type+'">';h+=(trans.type==='deposit'?'+':'-')+app.formatCurrency(trans.amount);h+='</div>';h+='</div>'});h+='</div>'}else{h+='<div style="text-align:center;padding:2rem;color:var(--text-secondary)">No transactions</div>'}h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-danger" onclick="app.deleteSavingsPlan(\''+pId+'\')">Delete Goal</button>';h+='<button class="button-secondary" onclick="app.closeModal()">Close</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
deleteSavingsPlan:function(pId){if(!confirm('Delete savings goal?'))return;var plans=this.getActiveSavingsPlans();delete plans[pId];this.saveToDrive();this.closeModal();this.renderSavingsPlans()},
exportData:function(){var st=this.getActiveState();var prof=this.getActiveProfileData();var plans=this.getActiveSavingsPlans();if(!prof){alert('No profile');return}var expData={profile:prof,savingsPlans:{},exportDate:new Date().toISOString()};Object.keys(plans).forEach(function(pId){expData.savingsPlans[pId]=plans[pId]});var dStr=JSON.stringify(expData,null,2);var blob=new Blob([dStr],{type:'application/json'});var url=URL.createObjectURL(blob);var link=document.createElement('a');link.href=url;link.download=prof.name.replace(/[^a-zA-Z0-9]/g,'_')+'_'+new Date().toISOString().split('T')[0]+'.json';link.click();URL.revokeObjectURL(url)},
importData:function(){var inp=document.createElement('input');inp.type='file';inp.accept='.json';inp.onchange=function(e){var file=e.target.files[0];if(!file)return;var reader=new FileReader();reader.onload=function(evt){try{var data=JSON.parse(evt.target.result);if(!data.profile||!data.profile.name){alert('Invalid file');return}var store=app.getActiveDataStore();var plans=app.getActiveSavingsPlans();var pName=data.profile.name;var cnt=1;while(store[pName]){pName=data.profile.name+' ('+cnt+')';cnt++}data.profile.name=pName;store[pName]=data.profile;if(data.savingsPlans){Object.keys(data.savingsPlans).forEach(function(pId){var newId='savings_'+Date.now()+'_'+Math.random();plans[newId]=data.savingsPlans[pId];plans[newId].id=newId})}app.getActiveState().activeProfileName=pName;app.saveToDrive();app.renderAll();alert('Imported as "'+pName+'"')}catch(err){alert('Failed to import')}};reader.readAsText(file)};inp.click()},
showSettings:function(){var h='<div class="modal-header">';h+='<div class="modal-title">Settings</div>';h+='<button class="modal-close" onclick="app.closeModal()">√ó</button>';h+='</div>';h+='<div class="modal-body">';h+='<div class="form-group">';h+='<label>Safety Buffer Amount</label>';h+='<input type="number" id="settingsSafetyBuffer" value="'+this.settings.safetyBuffer+'" step="1">';h+='<small style="color:var(--text-secondary);display:block;margin-top:0.5rem">Min balance before warnings</small>';h+='</div>';h+='</div>';h+='<div class="modal-footer">';h+='<button class="button-secondary" onclick="app.closeModal()">Cancel</button>';h+='<button class="button-primary" onclick="app.saveSettings()">Save</button>';h+='</div>';document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('active')},
saveSettings:function(){var sb=parseFloat(document.getElementById('settingsSafetyBuffer').value);if(isNaN(sb)||sb<0){alert('Enter valid amount');return}this.settings.safetyBuffer=sb;this.saveToDrive();this.closeModal();this.renderAll()},
updateReports:function(){var ids=this.getActiveUIContext();var st=this.getActiveState();var prof=this.getActiveProfileData();if(!prof)return;var rType=document.getElementById(ids.reportType).value;var period=parseInt(document.getElementById(ids.reportPeriod).value);if(st.reportChart){st.reportChart.destroy()}var ctx=document.getElementById(ids.reportChart);if(rType==='cashflow'){this.renderCashFlowChart(ctx,period,st)}else if(rType==='incomeVsExpenses'){this.renderIncomeExpensesChart(ctx,st)}else if(rType==='categoryBreakdown'){this.renderCategoryChart(ctx,st)}else if(rType==='netWorth'){this.renderNetWorthChart(ctx,period,st)}this.updateReportMetrics(period)},
renderCashFlowChart:function(ctx,days,st){var tdy=new Date();var fcst=this.calculateRunningBalance(tdy,days);var lbls=fcst.map(function(d){return d.date.toLocaleDateString('en-US',{month:'short',day:'numeric'})});var data=fcst.map(function(d){return d.balance});st.reportChart=new Chart(ctx,{type:'line',data:{labels:lbls,datasets:[{label:'Balance',data:data,borderColor:'rgb(37,99,235)',backgroundColor:'rgba(37,99,235,0.1)',tension:0.4},{label:'Safety Buffer',data:Array(data.length).fill(this.settings.safetyBuffer),borderColor:'rgb(239,68,68)',borderDash:[5,5],pointRadius:0,fill:false}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top'}},scales:{y:{beginAtZero:false,ticks:{callback:function(v){return '$'+v.toLocaleString()}}}}}})},
renderIncomeExpensesChart:function(ctx,st){var prof=this.getActiveProfileData();var mInc=0;var mExp=0;if(prof.incomes){prof.incomes.forEach(function(inc){mInc+=app.normalizeToMonthly(inc.amount,inc.frequency)})}if(prof.expenses){prof.expenses.forEach(function(exp){mExp+=app.normalizeToMonthly(exp.amount,exp.frequency)})}var cf=mInc-mExp;st.reportChart=new Chart(ctx,{type:'bar',data:{labels:['Income','Expenses','Net Cash Flow'],datasets:[{label:'Amount',data:[mInc,mExp,cf],backgroundColor:['rgba(16,185,129,0.8)','rgba(239,68,68,0.8)',cf>=0?'rgba(37,99,235,0.8)':'rgba(245,158,11,0.8)']}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{callback:function(v){return '$'+v.toLocaleString()}}}}}})},
renderCategoryChart:function(ctx,st){var prof=this.getActiveProfileData();var catTots={};if(prof.expenses){prof.expenses.forEach(function(exp){var mly=app.normalizeToMonthly(exp.amount,exp.frequency);if(!catTots[exp.category]){catTots[exp.category]=0}catTots[exp.category]+=mly})}var lbls=Object.keys(catTots);var data=Object.values(catTots);var colors=['rgba(239,68,68,0.8)','rgba(245,158,11,0.8)','rgba(16,185,129,0.8)','rgba(37,99,235,0.8)','rgba(139,92,246,0.8)','rgba(236,72,153,0.8)','rgba(14,165,233,0.8)','rgba(132,204,22,0.8)','rgba(251,191,36,0.8)','rgba(168,85,247,0.8)'];st.reportChart=new Chart(ctx,{type:'pie',data:{labels:lbls,datasets:[{data:data,backgroundColor:colors}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right'},tooltip:{callbacks:{label:function(c){var lbl=c.label||'';var val=c.parsed||0;var tot=c.dataset.data.reduce(function(a,b){return a+b},0);var pct=((val/tot)*100).toFixed(1);return lbl+': $'+val.toFixed(2)+' ('+pct+'%)'}}}}}})},
renderNetWorthChart:function(ctx,days,st){var prof=this.getActiveProfileData();var cAssets=0;var cDebts=0;if(prof.assets){prof.assets.forEach(function(a){if(a.category==='Debt'){cDebts+=Math.abs(a.value)}else{cAssets+=a.value}})}var tdy=new Date();var fcst=this.calculateRunningBalance(tdy,days);var lbls=fcst.map(function(d){return d.date.toLocaleDateString('en-US',{month:'short',day:'numeric'})});var data=fcst.map(function(d,i){return cAssets-cDebts+d.balance});st.reportChart=new Chart(ctx,{type:'line',data:{labels:lbls,datasets:[{label:'Net Worth',data:data,borderColor:'rgb(37,99,235)',backgroundColor:'rgba(37,99,235,0.1)',tension:0.4,fill:true}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top'}},scales:{y:{beginAtZero:false,ticks:{callback:function(v){return '$'+v.toLocaleString()}}}}}})},
updateReportMetrics:function(days){var ids=this.getActiveUIContext();var prof=this.getActiveProfileData();if(!prof)return;var mInc=0;var mExp=0;var dbtPay=0;if(prof.incomes){prof.incomes.forEach(function(inc){mInc+=app.normalizeToMonthly(inc.amount,inc.frequency)})}if(prof.expenses){prof.expenses.forEach(function(exp){var mly=app.normalizeToMonthly(exp.amount,exp.frequency);mExp+=mly;if(exp.category==='Debt Payment'){dbtPay+=mly}})}var cf=mInc-mExp;var savRate=mInc>0?(cf/mInc)*100:0;var d2i=mInc>0?(dbtPay/mInc)*100:0;var tdy=new Date();var fcst=this.calculateRunningBalance(tdy,Math.min(days,30));var avgBal=fcst.reduce(function(s,d){return s+d.balance},0)/fcst.length;document.getElementById(ids.savingsRate).textContent=savRate.toFixed(1)+'%';document.getElementById(ids.debtToIncome).textContent=d2i.toFixed(1)+'%';document.getElementById(ids.avgBalance).textContent=this.formatCurrency(avgBal)},
showAlerts:function(){this.updateAlerts();if(this.currentAlerts.length===0){alert('No alerts for the current profile.');return}var h='';this.currentAlerts.forEach(function(alrt){var dateStr=alrt.dateObj.toLocaleDateString('en-US',{weekday:'short',month:'long',day:'numeric',year:'numeric'});var balClass=alrt.type==='critical'?'negative':'warning';h+='<div class="alert-list-item '+alrt.type+'" onclick="app.goToAlertDay(\''+alrt.date+'\')"><div class="alert-icon">'+alrt.icon+'</div><div class="alert-content"><div class="alert-date">'+dateStr+'</div><div class="alert-message">'+alrt.message+'</div><div class="alert-balance '+balClass+'">Balance: '+app.formatCurrency(alrt.balance)+'</div></div></div>'});document.getElementById('alertListContainer').innerHTML=h;document.getElementById('alertsModal').classList.add('active')},
closeAlertsModal:function(){document.getElementById('alertsModal').classList.remove('active')},
goToAlertDay:function(dateString){var date=new Date(dateString);var state=this.getActiveState();this.closeAlertsModal();state.currentMonth=date.getMonth();state.currentYear=date.getFullYear();var viewPrefix=this.activeView==='personal'?'personal':'combined';var viewEl=document.getElementById(viewPrefix+'-app-view');viewEl.querySelectorAll('.tab-button').forEach(function(btn){btn.classList.remove('active')});viewEl.querySelectorAll('.tab-content').forEach(function(content){content.classList.remove('active')});var calendarTab=viewEl.querySelector('.tab-button[data-tab="'+viewPrefix+'-calendar"]');var calendarContent=document.getElementById(viewPrefix+'-calendar');if(calendarTab){calendarTab.classList.add('active')}if(calendarContent){calendarContent.classList.add('active')}this.updateCalendar()},
showDayDetail:function(dateString){var date=new Date(dateString);var title=date.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});document.getElementById('dayDetailTitle').textContent=title;var balData=this.calculateRunningBalance(date,1);var dayData=balData[0]||{balance:0,transactions:[]};var html='<div style="background:linear-gradient(135deg,var(--primary-color),#1d4ed8);color:white;padding:2rem;border-radius:8px;margin-bottom:2rem;text-align:center;">';html+='<div style="font-size:0.875rem;opacity:0.9;margin-bottom:0.5rem;">Ending Balance</div>';html+='<div style="font-size:3rem;font-weight:700;">'+this.formatCurrency(dayData.balance)+'</div>';if(dayData.balance<this.settings.safetyBuffer){html+='<div style="margin-top:1rem;padding:0.5rem 1rem;background:rgba(239,68,68,0.3);border-radius:4px;display:inline-block;">‚ö†Ô∏è Below Safety Buffer</div>'}html+='</div>';if(dayData.transactions.length===0){html+='<div style="padding:3rem;text-align:center;color:var(--text-secondary);">';html+='<div style="font-size:3rem;margin-bottom:1rem;">üìÖ</div>';html+='<h3>No Transactions</h3>';html+='<p style="margin-top:0.5rem;">No income or expenses scheduled for this day.</p></div>'}else{var incomes=[];var expenses=[];for(var i=0;i<dayData.transactions.length;i++){if(dayData.transactions[i].type==='income'){incomes.push(dayData.transactions[i])}else{expenses.push(dayData.transactions[i])}}var totalIncome=0;var totalExpense=0;for(var i=0;i<incomes.length;i++){totalIncome+=incomes[i].amount}for(var i=0;i<expenses.length;i++){totalExpense+=expenses[i].amount}var netChange=totalIncome-totalExpense;html+='<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:2rem;">';html+='<div style="background:var(--background);padding:1rem;border-radius:8px;text-align:center;">';html+='<div style="font-size:0.75rem;color:var(--text-secondary);">Income</div>';html+='<div style="font-size:1.5rem;font-weight:700;color:var(--success-color);">'+this.formatCurrency(totalIncome)+'</div></div>';html+='<div style="background:var(--background);padding:1rem;border-radius:8px;text-align:center;">';html+='<div style="font-size:0.75rem;color:var(--text-secondary);">Expenses</div>';html+='<div style="font-size:1.5rem;font-weight:700;color:var(--danger-color);">'+this.formatCurrency(totalExpense)+'</div></div>';html+='<div style="background:var(--background);padding:1rem;border-radius:8px;text-align:center;">';html+='<div style="font-size:0.75rem;color:var(--text-secondary);">Net Change</div>';html+='<div style="font-size:1.5rem;font-weight:700;color:'+(netChange>=0?'var(--success-color)':'var(--danger-color)')+';">';html+=(netChange>=0?'+':'')+this.formatCurrency(netChange)+'</div></div></div>';if(incomes.length>0){html+='<div style="margin-bottom:2rem;"><h3 style="font-size:1.125rem;font-weight:600;margin-bottom:1rem;color:var(--success-color);">üí∞ Income ('+incomes.length+')</h3>';for(var i=0;i<incomes.length;i++){var inc=incomes[i];html+='<div style="background:#f0fdf4;border-left:4px solid var(--success-color);padding:1rem;border-radius:4px;margin-bottom:0.75rem;">';html+='<div style="display:flex;justify-content:space-between;align-items:center;"><div>';html+='<div style="font-weight:600;margin-bottom:0.25rem;">'+this.escapeHtml(inc.name)+'</div>';html+='<div style="font-size:0.875rem;color:var(--text-secondary);">'+inc.frequency+'</div></div>';html+='<div style="font-size:1.25rem;font-weight:700;color:var(--success-color);">+'+this.formatCurrency(inc.amount)+'</div></div></div>'}html+='</div>'}if(expenses.length>0){html+='<div style="margin-bottom:2rem;"><h3 style="font-size:1.125rem;font-weight:600;margin-bottom:1rem;color:var(--danger-color);">üí≥ Expenses ('+expenses.length+')</h3>';for(var i=0;i<expenses.length;i++){var exp=expenses[i];html+='<div style="background:#fef2f2;border-left:4px solid var(--danger-color);padding:1rem;border-radius:4px;margin-bottom:0.75rem;">';html+='<div style="display:flex;justify-content:space-between;align-items:center;"><div>';html+='<div style="font-weight:600;margin-bottom:0.25rem;">'+this.escapeHtml(exp.name)+'</div>';html+='<div style="font-size:0.875rem;color:var(--text-secondary);">'+(exp.category||'Uncategorized')+' ‚Ä¢ '+exp.frequency+'</div></div>';html+='<div style="font-size:1.25rem;font-weight:700;color:var(--danger-color);">-'+this.formatCurrency(exp.amount)+'</div></div></div>'}html+='</div>'}}document.getElementById('dayDetailContent').innerHTML=html;document.getElementById('dayDetailModal').classList.add('active')},
closeDayDetailModal:function(){document.getElementById('dayDetailModal').classList.remove('active')},
closeModal:function(){document.getElementById('modalOverlay').classList.remove('active')},
formatCurrency:function(amt){return '$'+amt.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,',')},
escapeHtml:function(txt){var div=document.createElement('div');div.textContent=txt;return div.innerHTML},
setupEventListeners:function(){var self=this;document.getElementById('signInButton').addEventListener('click',function(){self.signIn()});document.getElementById('signOutButton').addEventListener('click',function(){self.signOut()});document.getElementById('nav-personal').addEventListener('click',function(){self.switchView('personal')});document.getElementById('nav-combined').addEventListener('click',function(){self.switchView('combined')});document.getElementById('manageProfilesBtn').addEventListener('click',function(){self.showProfileManager()});document.getElementById('exportBtn').addEventListener('click',function(){self.exportData()});document.getElementById('importBtn').addEventListener('click',function(){self.importData()});document.getElementById('settingsBtn').addEventListener('click',function(){self.showSettings()});document.querySelectorAll('.tab-button').forEach(function(btn){btn.addEventListener('click',function(){var tabId=this.getAttribute('data-tab');var vPrefix=tabId.split('-')[0];var vEl=document.getElementById(vPrefix+'-app-view');vEl.querySelectorAll('.tab-button').forEach(function(b){b.classList.remove('active')});this.classList.add('active');vEl.querySelectorAll('.tab-content').forEach(function(c){c.classList.remove('active')});document.getElementById(tabId).classList.add('active');if(tabId.endsWith('-reports')){self.updateReports()}})});document.getElementById('personal-addItemBtn').addEventListener('click',function(){self.showAddItemModal()});document.getElementById('personal-manageProfilesBtn').addEventListener('click',function(){self.showProfileManager()});document.getElementById('personal-profileSelect').addEventListener('change',function(){self.personalState.activeProfileName=this.value;self.settings.lastUsedPersonalProfile=this.value;self.saveToDrive();self.renderAll()});document.getElementById('personal-prevMonth').addEventListener('click',function(){self.prevMonth()});document.getElementById('personal-nextMonth').addEventListener('click',function(){self.nextMonth()});document.getElementById('personal-todayBtn').addEventListener('click',function(){self.goToToday()});document.getElementById('personal-createSavingsPlanBtn').addEventListener('click',function(){self.showCreateSavingsPlan()});document.getElementById('personal-reportType').addEventListener('change',function(){self.updateReports()});document.getElementById('personal-reportPeriod').addEventListener('change',function(){self.updateReports()});document.getElementById('combined-addItemBtn').addEventListener('click',function(){self.showAddItemModal()});document.getElementById('combined-manageProfilesBtn').addEventListener('click',function(){self.showProfileManager()});document.getElementById('combined-profileSelect').addEventListener('change',function(){self.combinedState.activeProfileName=this.value;self.settings.lastUsedCombinedProfile=this.value;self.saveToDrive();self.renderAll()});document.getElementById('combined-prevMonth').addEventListener('click',function(){self.prevMonth()});document.getElementById('combined-nextMonth').addEventListener('click',function(){self.nextMonth()});document.getElementById('combined-todayBtn').addEventListener('click',function(){self.goToToday()});document.getElementById('combined-createSavingsPlanBtn').addEventListener('click',function(){self.showCreateSavingsPlan()});document.getElementById('combined-reportType').addEventListener('change',function(){self.updateReports()});document.getElementById('combined-reportPeriod').addEventListener('change',function(){self.updateReports()});document.getElementById('alertBadge').addEventListener('click',function(){self.showAlerts()});document.getElementById('modalOverlay').addEventListener('click',function(e){if(e.target===this){self.closeModal()}})}};
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',function(){app.init()})}else{app.init()}
</script>

<div id="dayDetailModal" class="modal-overlay">
<div class="modal">
<div class="modal-header">
<div class="modal-title" id="dayDetailTitle">Day Details</div>
<button class="modal-close" onclick="app.closeDayDetailModal()">√ó</button>
</div>
<div class="modal-body">
<div id="dayDetailContent"></div>
</div>
<div class="modal-footer">
<button class="button-secondary" onclick="app.closeDayDetailModal()">Close</button>
</div>
</div>
</div>

</body>
</html>
